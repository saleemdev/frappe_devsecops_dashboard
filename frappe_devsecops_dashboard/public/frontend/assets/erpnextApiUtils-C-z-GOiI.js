import p from"./index-B0yp3bM1.js";const i="/api/method",s=p.create({baseURL:i,timeout:3e4,headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":window.csrf_token||""}});s.interceptors.request.use(t=>(window.csrf_token&&(t.headers["X-Frappe-CSRF-Token"]=window.csrf_token),t.headers.Accept="application/json",t.headers["Content-Type"]="application/json",delete t.headers.Expect,t),t=>Promise.reject(t));s.interceptors.response.use(t=>t,t=>Promise.reject(t));const n=async()=>{try{const t=await s.get("frappe_devsecops_dashboard.api.dashboard.get_dashboard_data");if(t.data&&t.data.message){const e=t.data.message;return{success:e.success||!1,projects:d(e.projects||[]),metrics:l(e.metrics||{}),lifecycle_phases:e.lifecycle_phases||[],timestamp:e.timestamp}}throw new Error("Invalid response format")}catch(t){return{success:!1,error:t.message||"Failed to fetch dashboard data",projects:[],metrics:{total_projects:0,active_projects:0,total_tasks:0,completed_tasks:0,average_completion:0,team_capacity:0,completion_rate:0},lifecycle_phases:[]}}},_=async t=>{try{const e=await s.get("frappe_devsecops_dashboard.api.dashboard.get_project_details",{params:{project_name:t}});if(e.data&&e.data.message){const r=e.data.message;if(r.success)return{success:!0,project:c(r.project)};throw new Error(r.error||"Failed to fetch project details")}throw new Error("Invalid response format")}catch(e){return{success:!1,error:e.message||"Failed to fetch project details",project:null}}},d=t=>t.map(e=>c(e)),c=t=>({id:t.id||t.name,name:t.name||t.project_name||"Unnamed Project",project_name:t.project_name||t.name,project_status:t.project_status||t.status||"Open",status:t.status||t.project_status||"Open",client:t.client||t.customer||"No Client",customer:t.customer||t.client,project_type:t.project_type||"Standard",priority:t.priority||"Medium",progress:parseFloat(t.progress||t.percent_complete||0),percent_complete:parseFloat(t.percent_complete||t.progress||0),completion_rate:parseFloat(t.completion_rate||0),task_count:parseInt(t.task_count||0),total_tasks:parseInt(t.total_tasks||t.task_count||0),completed_tasks:parseInt(t.completed_tasks||0),current_phase:t.current_phase||"Planning",currentPhase:t.currentPhase||t.current_phase||"Planning",delivery_phases:o(t.delivery_phases||[]),deliveryPhases:o(t.delivery_phases||[]),expected_start_date:t.expected_start_date,expected_end_date:t.expected_end_date,actual_start_date:t.actual_start_date,actual_end_date:t.actual_end_date,cost_center:t.cost_center,department:t.department,tasks:t.tasks||[]}),o=t=>t.map(e=>({section_id:e.section_id,section_name:e.section_name||e.name,section_status:e.section_status||e.status,section_progress:parseFloat(e.section_progress||e.progress||0),section_order:parseInt(e.section_order||0),task_count:parseInt(e.task_count||0),completed_tasks:parseInt(e.completed_tasks||0),in_progress_tasks:parseInt(e.in_progress_tasks||0),name:e.name||e.section_name,status:e.status||e.section_status,progress:parseFloat(e.progress||e.section_progress||0)})),l=t=>({total_projects:parseInt(t.total_projects||0),active_projects:parseInt(t.active_projects||0),activeProjects:parseInt(t.active_projects||t.activeProjects||0),total_tasks:parseInt(t.total_tasks||0),totalTasks:parseInt(t.total_tasks||t.totalTasks||0),completed_tasks:parseInt(t.completed_tasks||0),completedTasks:parseInt(t.completed_tasks||t.completedTasks||0),average_completion:parseFloat(t.average_completion||0),completion_rate:parseFloat(t.completion_rate||0),team_capacity:parseFloat(t.team_capacity||0),teamCapacity:parseFloat(t.team_capacity||t.teamCapacity||0)}),m=async()=>{try{const t=await s.get("/api/resource/Task Type");return t.data&&t.data.data?t.data.data.map(e=>({name:e.name,description:e.description||`${e.name} phase`})):[]}catch{return[]}},u=async()=>{try{const t=await s.get("/api/resource/Project",{params:{fields:JSON.stringify(["name","project_name","status","customer","percent_complete"]),filters:JSON.stringify([["disabled","=",0]])}});return t.data&&t.data.data?t.data.data:[]}catch{return[]}},g=async t=>{try{const e=await s.get("/api/resource/Task",{params:{fields:JSON.stringify(["name","subject","status","priority","project","task_type","exp_start_date","exp_end_date","_assign","description"]),filters:JSON.stringify([["project","=",t]]),limit_page_length:999}});return e.data&&e.data.data?e.data.data.map(a=>({id:a.name,name:a.name,subject:a.subject,status:a.status,priority:a.priority,project:a.project,task_type:a.task_type,due_date:a.exp_end_date,start_date:a.exp_start_date,assigned_to:a._assign?JSON.parse(a._assign)[0]:null,description:a.description})):[]}catch{return[]}},k=n,y=async()=>s,h={getDashboardData:n,getProjectDetails:_,getTaskTypes:m,getProjects:u,getProjectsWithTasks:n,getProjectTasksWithTypes:g,createApiClient:y};export{y as createApiClient,h as default,n as getDashboardData,_ as getProjectDetails,g as getProjectTasksWithTypes,u as getProjects,k as getProjectsWithTasks,m as getTaskTypes};
