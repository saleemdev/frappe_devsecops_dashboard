<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />

    <!-- Favicon and app icons -->
    <link rel="icon" type="image/svg+xml" href="/assets/frappe_devsecops_dashboard/frontend/favicon.svg" />
    <link rel="icon" type="image/svg+xml" sizes="16x16" href="/assets/frappe_devsecops_dashboard/frontend/favicon-16x16.svg" />
    <link rel="icon" type="image/svg+xml" sizes="32x32" href="/assets/frappe_devsecops_dashboard/frontend/favicon-32x32.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/frappe_devsecops_dashboard/frontend/apple-touch-icon.svg" />

    <!-- Responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- App metadata -->
    <meta name="description" content="DOD DevSecOps Dashboard - Comprehensive project management and security monitoring for Department of Defense DevSecOps initiatives" />
    <meta name="keywords" content="DevSecOps, DOD, Department of Defense, Security, Development, Operations, Dashboard, Project Management" />
    <meta name="author" content="DOD DevSecOps Initiative" />
    <meta name="theme-color" content="#1890ff" />

    <!-- Open Graph metadata -->
    <meta property="og:title" content="DOD DevSecOps Dashboard" />
    <meta property="og:description" content="Comprehensive project management and security monitoring for Department of Defense DevSecOps initiatives" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/apple-touch-icon.svg" />

    <!-- Twitter Card metadata -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="DOD DevSecOps Dashboard" />
    <meta name="twitter:description" content="Comprehensive project management and security monitoring for Department of Defense DevSecOps initiatives" />
    <meta name="twitter:image" content="/apple-touch-icon.svg" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/assets/frappe_devsecops_dashboard/frontend/manifest.json" />

    <title>DOD DevSecOps Dashboard</title>
    <script>
      // Dynamically load frontend assets based on Vite manifest
      (function() {
        // Fallback hashes in case API fails (for initial deployments)
        // Note: These should NOT include 'assets/' prefix as BASE_PATH already includes it
        const FALLBACK_JS = 'index-DaLh_DBz.js';
        const FALLBACK_CSS = 'index-BwEIo6un.css';
        const BASE_PATH = '/assets/frappe_devsecops_dashboard/frontend/assets/';

        async function loadAssets() {
          try {
            // Try to fetch the manifest from the API endpoint
            const response = await fetch('/api/method/frappe_devsecops_dashboard.api.dashboard.get_frontend_assets');
            const data = await response.json();

            let jsFile = FALLBACK_JS;
            let cssFile = FALLBACK_CSS;

            // Use API response if successful
            if (data.message && data.message.success && data.message.js_file) {
              jsFile = data.message.js_file;
              if (data.message.css_file) {
                cssFile = data.message.css_file;
              }
            }

            // Load CSS
            if (cssFile) {
              const link = document.createElement('link');
              link.rel = 'stylesheet';
              link.crossOrigin = 'anonymous';
              link.href = BASE_PATH + cssFile;
              document.head.appendChild(link);
            }

            // Load JavaScript
            if (jsFile) {
              const script = document.createElement('script');
              script.type = 'module';
              script.crossOrigin = 'anonymous';
              script.src = BASE_PATH + jsFile;
              document.head.appendChild(script);
            }
          } catch (error) {
            console.error('Failed to load frontend assets:', error);
            // Fallback: load with hardcoded hashes
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.crossOrigin = 'anonymous';
            link.href = BASE_PATH + FALLBACK_CSS;
            document.head.appendChild(link);

            const script = document.createElement('script');
            script.type = 'module';
            script.crossOrigin = 'anonymous';
            script.src = BASE_PATH + FALLBACK_JS;
            document.head.appendChild(script);
          }
        }

        // Load assets when DOM is ready
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', loadAssets);
        } else {
          loadAssets();
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script>window.csrf_token='{{ frappe.session.csrf_token }}'</script>
  </body>
</html>
